:root{
  --bg1:#ffeff6;
  --bg2:#eaf6ff;
  --ink:#1f2430;
  --muted:#5b6071;
  --white:#fff;
  --pink:#ff5fa2;
  --pink2:#ff86bc;
  --mint:#22c7a9;
  --shadow: 0 18px 50px rgba(19, 22, 31, .12);
  --shadow2: 0 10px 30px rgba(19, 22, 31, .10);
  --radius: 22px;
  --radius2: 16px;
  --ring: 0 0 0 4px rgba(255, 95, 162, .18);
  --max: 980px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--ink);
  font-family: ui-rounded, system-ui, -apple-system, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
  background:
    radial-gradient(1200px 700px at 20% -10%, #fff 0%, rgba(255,255,255,0) 60%),
    radial-gradient(900px 600px at 90% 10%, rgba(255,255,255,.9) 0%, rgba(255,255,255,0) 60%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
  overflow-x:hidden;
}

.app{
  min-height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding: 18px 14px 70px;
}

.panel{
  width:100%;
  max-width: var(--max);
  margin: 0 auto;
}
.panel--center{
  min-height: calc(100dvh - 110px);
  display:flex;
  align-items:center;
  justify-content:center;
}
.is-hidden{display:none !important}

/* 3D 圣诞树全屏舞台 */
.treePanel{
  position: fixed;
  inset: 0;
  z-index: 2;
}
.treeStage{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
}
.treeCanvas{
  width:100%;
  height:100%;
  display:block;
  touch-action: none; /* 让拖拽更丝滑（不触发页面滚动） */
}
.treeHud{
  position:absolute;
  left: 14px;
  right: 14px;
  top: 14px;
  display:flex;
  flex-direction:column;
  gap: 10px;
  pointer-events:none; /* HUD 不抢 canvas 手势；按钮再单独打开 */
}
.treeHud__top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: 10px;
}
.treeHud__tips{
  color: rgba(31,36,48,.58);
  font-size: 12px;
  font-weight:700;
  text-shadow: 0 8px 26px rgba(255,255,255,.55);
}
.treeHud__actions{
  display:flex;
  gap: 10px;
  pointer-events:auto;
}
.treeHud__actions .btn{
  flex:1;
  box-shadow: none;
  background: rgba(255,255,255,.72);
  backdrop-filter: blur(10px);
}
.treeHud__actions .btn--danger{
  background: rgba(255,255,255,.78);
}

body.is-tree-mode{
  overflow:hidden;
}

.card{
  width:min(560px, 92vw);
  background: var(--white);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 20px 18px;
  position:relative;
  overflow:hidden;
}
.card--glass{
  background: rgba(255,255,255,.72);
  backdrop-filter: blur(10px);
}
.card--game{
  width:min(700px, 94vw);
  padding: 18px;
}
.card--reward{
  width:min(780px, 94vw);
  padding: 18px;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-weight:700;
  font-size: 13px;
  color:#7d2c54;
  background: linear-gradient(90deg, rgba(255,95,162,.18), rgba(255,134,188,.22));
  border: 1px solid rgba(255,95,162,.20);
  padding: 8px 12px;
  border-radius: 999px;
}
.badge--win{
  background: linear-gradient(90deg, rgba(34,199,169,.18), rgba(255,95,162,.12));
  border-color: rgba(34,199,169,.22);
  color:#175e50;
}

.title{
  margin: 14px 0 10px;
  font-size: 34px;
  line-height: 1.15;
  letter-spacing: .2px;
}
.subtitle{
  margin: 0 0 14px;
  color: var(--muted);
  font-size: 15px;
  line-height:1.6;
}
.title2{
  margin: 10px 0 12px;
  font-size: 26px;
}

.btn{
  appearance:none;
  border:0;
  border-radius: 14px;
  padding: 12px 14px;
  font-weight:800;
  font-size: 15px;
  cursor:pointer;
  box-shadow: var(--shadow2);
  transform: translateY(0);
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
  user-select:none;
}
.btn:active{transform: translateY(1px); filter: brightness(.98)}
.btn:focus-visible{outline:none; box-shadow: var(--shadow2), var(--ring)}

.btn--primary{
  width:100%;
  background: linear-gradient(135deg, var(--pink), var(--pink2));
  color: var(--white);
}
.btn--ghost{
  background: rgba(255,255,255,.72);
  border: 1px solid rgba(31,36,48,.10);
  box-shadow: none;
}
.btn--danger{
  border-color: rgba(255,95,162,.22);
  color: #b22462;
}
.btn[disabled]{opacity:.55; cursor:not-allowed}

.hint{
  margin: 12px 2px 0;
  color: rgba(31,36,48,.55);
  font-size: 12px;
}
.hint--center{text-align:center}

.header{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  margin-bottom: 14px;
}
.chip{
  display:inline-flex;
  align-items:center;
  border-radius: 999px;
  padding: 8px 11px;
  font-size: 12px;
  font-weight:700;
  background: rgba(255,255,255,.7);
  border: 1px solid rgba(31,36,48,.10);
}
.chip--soft{
  background: rgba(34,199,169,.14);
  border-color: rgba(34,199,169,.18);
  color:#0c5a4d;
}

.giftWrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  padding: 12px 0 2px;
}
.giftText{
  margin:0;
  font-weight:700;
  color: rgba(31,36,48,.65);
}
.gift{
  width: 150px;
  height: 150px;
  border:0;
  background: transparent;
  position:relative;
  cursor:pointer;
  outline:none;
}
.gift__box{
  position:absolute;
  left: 18px;
  top: 55px;
  width: 114px;
  height: 86px;
  border-radius: 16px;
  background: linear-gradient(180deg, #ff93c1, #ff5fa2);
  box-shadow: var(--shadow2);
}
.gift__lid{
  position:absolute;
  left: 12px;
  top: 35px;
  width: 126px;
  height: 35px;
  border-radius: 16px;
  background: linear-gradient(180deg, #ffd3e6, #ff86bc);
  box-shadow: 0 12px 30px rgba(255,95,162,.28);
  transform-origin: 15% 100%;
  transition: transform .35s ease;
}
.gift__ribbon{
  position:absolute;
  left: 70px;
  top: 35px;
  width: 10px;
  height: 106px;
  background: linear-gradient(180deg, #fff7, #fff0);
  border-radius: 10px;
  filter: saturate(1.2);
}
.gift__bow{
  position:absolute;
  left: 63px;
  top: 19px;
  width: 24px;
  height: 24px;
  border-radius: 10px;
  background: linear-gradient(135deg, #22c7a9, #7cf0db);
  box-shadow: 0 10px 22px rgba(34,199,169,.18);
  transform: rotate(8deg);
}
.gift.is-open .gift__lid{
  transform: rotate(-24deg) translateY(-10px);
}
.gift:hover .gift__lid{transform: rotate(-7deg)}

.actions{
  margin-top: 14px;
  display:flex;
  gap:10px;
  flex-direction:column;
}
.actions--row{flex-direction:row}
.actions--row .btn{flex:1}

.gameTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  margin-bottom: 14px;
}
.gameTitle{font-weight:900; font-size: 18px}
.gameSub{margin-top:4px; color: rgba(31,36,48,.55); font-size: 12px}
.score{display:flex; gap:10px; align-items:center}
.scoreItem{
  background: rgba(255,255,255,.72);
  border: 1px solid rgba(31,36,48,.10);
  border-radius: 12px;
  padding: 8px 10px;
  min-width: 74px;
  text-align:center;
}
.scoreLabel{display:block; font-size: 11px; color: rgba(31,36,48,.55); font-weight:700}
.scoreValue{display:block; font-size: 16px; font-weight:900}

.board{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 10px;
  background: rgba(255,255,255,.62);
  border-radius: var(--radius2);
  border: 1px solid rgba(31,36,48,.08);
}

.board--lights{
  background:
    radial-gradient(120px 120px at 20% 20%, rgba(255,255,255,.85), rgba(255,255,255,0) 60%),
    radial-gradient(120px 120px at 80% 20%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
    radial-gradient(160px 160px at 50% 110%, rgba(34,199,169,.12), rgba(255,255,255,0) 60%),
    rgba(255,255,255,.62);
}

.lightTile{
  position:relative;
  aspect-ratio: 1 / 1;
  border-radius: 18px;
  border: 1px solid rgba(31,36,48,.08);
  background: rgba(255,255,255,.72);
  cursor:pointer;
  user-select:none;
  box-shadow: 0 10px 20px rgba(19,22,31,.10);
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .12s ease, filter .12s ease, box-shadow .18s ease;
}
.lightTile:active{transform: translateY(1px); filter: brightness(.99)}
.lightTile:focus-visible{outline:none; box-shadow: var(--shadow2), var(--ring)}
.lightTile.is-disabled{pointer-events:none}

.bulb{
  width: 44px;
  height: 44px;
  position:relative;
  display:block;
}
.bulb__core{
  position:absolute;
  inset:0;
  border-radius: 999px;
  background: radial-gradient(circle at 35% 30%, #fff, rgba(255,255,255,.0) 55%),
              radial-gradient(circle at 40% 35%, rgba(255,255,255,.9), rgba(255,255,255,0) 52%),
              radial-gradient(circle at 50% 55%, rgba(255,95,162,.55), rgba(255,95,162,.08) 60%),
              rgba(31,36,48,.08);
  border: 1px solid rgba(31,36,48,.10);
  filter: saturate(.95);
}
.bulb__glow{
  position:absolute;
  inset:-10px;
  border-radius: 999px;
  opacity: 0;
  background: radial-gradient(circle, rgba(255,209,102,.55), rgba(255,209,102,0) 60%);
  transition: opacity .18s ease, transform .18s ease;
  transform: scale(.95);
}

.lightTile.is-lit .bulb__core{
  background: radial-gradient(circle at 35% 30%, #fff, rgba(255,255,255,0) 55%),
              radial-gradient(circle at 40% 35%, rgba(255,255,255,.95), rgba(255,255,255,0) 52%),
              radial-gradient(circle at 50% 55%, rgba(255,209,102,.95), rgba(255,209,102,.18) 60%),
              linear-gradient(180deg, rgba(255,134,188,.42), rgba(34,199,169,.22));
  border-color: rgba(255,209,102,.45);
}
.lightTile.is-lit .bulb__glow{
  opacity: 1;
  transform: scale(1);
}
.lightTile.is-lit{
  box-shadow: 0 16px 34px rgba(255,209,102,.16), 0 12px 26px rgba(34,199,169,.10);
}
.photoFrame{
  position:relative;
  border-radius: var(--radius2);
  overflow:hidden;
  border: 1px solid rgba(31,36,48,.10);
  background: linear-gradient(135deg, rgba(255,95,162,.12), rgba(34,199,169,.10));
  aspect-ratio: 4 / 3;
}
.photoFrame--solo{
  margin-top: 10px;
}
.photo{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;
}
.photoFallback{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  text-align:center;
  padding: 16px;
  color: rgba(31,36,48,.70);
}
.fallbackTitle{font-weight:900; margin-bottom:6px}
.fallbackSub{font-size:12px; color: rgba(31,36,48,.55)}
.photoFallback code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  background: rgba(255,255,255,.7);
  padding: 2px 6px;
  border-radius: 8px;
  border: 1px solid rgba(31,36,48,.08);
}

/* 轻微极光光晕（更圣诞、更“美”） */
body::before{
  content:"";
  position: fixed;
  inset: -30vh -20vw;
  pointer-events:none;
  background:
    radial-gradient(420px 260px at 20% 20%, rgba(34,199,169,.18), rgba(34,199,169,0) 65%),
    radial-gradient(420px 260px at 80% 25%, rgba(255,134,188,.16), rgba(255,134,188,0) 65%),
    radial-gradient(520px 320px at 55% 0%, rgba(255,209,102,.14), rgba(255,209,102,0) 65%);
  filter: blur(8px);
  opacity:.9;
}

.footer{
  margin-top: 18px;
  color: rgba(31,36,48,.45);
  font-size: 12px;
}

/* 雪花 */
#snow{position:fixed; inset:0; pointer-events:none; overflow:hidden}
.flake{
  position:absolute;
  top: -10vh;
  width: 10px;
  height: 10px;
  opacity:.9;
  background: rgba(255,255,255,.85);
  border-radius: 99px;
  filter: blur(.2px);
  box-shadow: 0 0 0 1px rgba(255,255,255,.55);
  animation: fall linear forwards;
}
@keyframes fall{
  to{
    transform: translate3d(var(--drift, 0px), 120vh, 0) rotate(360deg);
    opacity: .85;
  }
}

/* 小心心/烟花粒子层 */
#fx{position:fixed; inset:0; pointer-events:none}
.pop{
  position:absolute;
  transform: translate(-50%,-50%);
  animation: pop 900ms ease forwards;
  font-size: 16px;
  filter: drop-shadow(0 10px 18px rgba(255,95,162,.22));
}
@keyframes pop{
  0%{opacity:0; transform: translate(-50%,-50%) scale(.7)}
  30%{opacity:1}
  100%{opacity:0; transform: translate(-50%,-120%) scale(1.2)}
}
.spark{
  position:absolute;
  width: 6px;
  height: 6px;
  border-radius: 99px;
  transform: translate(-50%,-50%);
  animation: spark 900ms ease-out forwards;
  opacity:.95;
}
@keyframes spark{
  to{
    transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy)));
    opacity:0;
  }
}

@media (max-width: 420px){
  .title{font-size: 30px}
  .card{padding: 18px 16px}
  .board{gap: 9px}
}


